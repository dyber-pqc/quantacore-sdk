# D:\quantacore-sdk\integrations\pkcs11\quac100_sunpkcs11.cfg
#
# QUAC 100 PKCS#11 - Java SunPKCS11 Provider Configuration
#
# This file configures the Java SunPKCS11 provider to use the
# QUAC 100 hardware security module for cryptographic operations.
#
# Usage:
#   1. Edit library path below
#   2. Load provider in code or via java.security
#
# Copyright 2025 Dyber, Inc. All Rights Reserved.

# =============================================================================
# Basic Configuration
# =============================================================================

# Provider name (appears in Security.getProvider())
name = QUAC100

# PKCS#11 library path
# Linux:   /usr/lib/libquac100_pkcs11.so
# Windows: C:/Program Files/Dyber/quac100_pkcs11.dll
# macOS:   /usr/local/lib/libquac100_pkcs11.dylib
library = C:/Program Files/Dyber/quac100_pkcs11.dll

# Optional: Description for the provider
description = QUAC 100 Post-Quantum Cryptographic HSM

# =============================================================================
# Slot/Token Selection
# =============================================================================

# Slot number to use (0-based)
# Use -1 to auto-select first available slot with a token
slot = 0

# Alternative: Select by slot list index
# slotListIndex = 0

# Alternative: Select by token description (partial match)
# token = QUAC 100

# =============================================================================
# Login Configuration
# =============================================================================

# Show login dialog for PIN entry
showInfo = true

# Key store type to register
# Available: PKCS11, PKCS11-<name>
keyStoreType = PKCS11

# =============================================================================
# Mechanism Configuration
# =============================================================================

# Enable/disable specific mechanisms
# Format: enabledMechanisms = { CKM_xxx CKM_yyy }
# or:     disabledMechanisms = { CKM_xxx CKM_yyy }

# Enable post-quantum mechanisms (vendor-defined)
# Note: Standard Java may not recognize these; use with custom provider
# enabledMechanisms = {
#   CKM_ML_KEM_768_KEYGEN
#   CKM_ML_KEM_768_ENCAPS
#   CKM_ML_KEM_768_DECAPS
#   CKM_ML_DSA_65_KEYGEN
#   CKM_ML_DSA_65
# }

# Enable standard mechanisms for hybrid operations
enabledMechanisms = {
  CKM_RSA_PKCS_KEY_PAIR_GEN
  CKM_RSA_PKCS
  CKM_SHA256_RSA_PKCS
  CKM_SHA384_RSA_PKCS
  CKM_SHA512_RSA_PKCS
  CKM_EC_KEY_PAIR_GEN
  CKM_ECDSA
  CKM_ECDSA_SHA256
  CKM_ECDSA_SHA384
  CKM_ECDSA_SHA512
  CKM_ECDH1_DERIVE
  CKM_AES_KEY_GEN
  CKM_AES_CBC
  CKM_AES_CBC_PAD
  CKM_AES_GCM
  CKM_SHA256
  CKM_SHA384
  CKM_SHA512
}

# =============================================================================
# Attribute Configuration
# =============================================================================

# Default key attributes
# Format: attributes(<op>, <type>, <attrs>) = { CKA_xxx = <value> }

# Sensitive keys stay in hardware
attributes(generate, *, *) = {
  CKA_TOKEN = true
}

# Private keys are sensitive and not extractable
attributes(generate, CKO_PRIVATE_KEY, *) = {
  CKA_SENSITIVE = true
  CKA_EXTRACTABLE = false
}

# Secret keys are sensitive
attributes(generate, CKO_SECRET_KEY, *) = {
  CKA_SENSITIVE = true
  CKA_EXTRACTABLE = false
}

# =============================================================================
# NSS Compatibility (if using NSS-based PKCS#11)
# =============================================================================

# NSS database directory (if applicable)
# nssDbMode = readWrite
# nssSecmodDirectory = /etc/pki/nssdb

# =============================================================================
# Advanced Options
# =============================================================================

# Clear secrets from memory after use
# clearAllKeys = true

# Use user-type PIN for all operations (not SO PIN)
# omitInitialize = false

# Multi-threaded token access
# insertionCheckInterval = 1000

# Function list pointer (usually auto-detected)
# functionList = default

# =============================================================================
# Java Code Example
# =============================================================================
#
# // Load provider from config file
# Provider provider = Security.getProvider("SunPKCS11");
# provider = provider.configure("/path/to/quac100_sunpkcs11.cfg");
# Security.addProvider(provider);
#
# // Or programmatically
# String config = "name = QUAC100\n" +
#                 "library = /usr/lib/libquac100_pkcs11.so\n" +
#                 "slot = 0";
# Provider provider = Security.getProvider("SunPKCS11");
# provider = provider.configure("--" + config);
# Security.addProvider(provider);
#
# // Use KeyStore
# KeyStore ks = KeyStore.getInstance("PKCS11", provider);
# char[] pin = "1234".toCharArray();
# ks.load(null, pin);
#
# // List keys
# Enumeration<String> aliases = ks.aliases();
# while (aliases.hasMoreElements()) {
#     String alias = aliases.nextElement();
#     System.out.println("Key: " + alias);
# }
#
# // Generate key pair (standard algorithms)
# KeyPairGenerator kpg = KeyPairGenerator.getInstance("EC", provider);
# kpg.initialize(new ECGenParameterSpec("secp256r1"));
# KeyPair kp = kpg.generateKeyPair();
#
# // Sign
# Signature sig = Signature.getInstance("SHA256withECDSA", provider);
# sig.initSign(kp.getPrivate());
# sig.update(data);
# byte[] signature = sig.sign();
#
# =============================================================================
# Java Security Properties (java.security file)
# =============================================================================
#
# Add to $JAVA_HOME/conf/security/java.security:
#
# # QUAC 100 PKCS#11 Provider
# security.provider.N=SunPKCS11 /path/to/quac100_sunpkcs11.cfg
#
# Where N is the next available provider number
#
# =============================================================================
# Command Line Configuration
# =============================================================================
#
# Run Java with provider:
#
#   java -Djava.security.debug=sunpkcs11 \
#        -Djava.security.properties=/path/to/java.security.extra \
#        -jar myapp.jar
#
# java.security.extra contents:
#   security.provider.1=SunPKCS11 /path/to/quac100_sunpkcs11.cfg
#
# =============================================================================
# keytool Commands
# =============================================================================
#
# List keys in PKCS#11 token:
#   keytool -list -keystore NONE -storetype PKCS11 \
#           -providerClass sun.security.pkcs11.SunPKCS11 \
#           -providerArg /path/to/quac100_sunpkcs11.cfg
#
# Generate key pair:
#   keytool -genkeypair -alias mykey -keyalg EC -keysize 256 \
#           -sigalg SHA256withECDSA -keystore NONE -storetype PKCS11 \
#           -providerClass sun.security.pkcs11.SunPKCS11 \
#           -providerArg /path/to/quac100_sunpkcs11.cfg \
#           -dname "CN=Test, O=Dyber"
#
# Generate CSR:
#   keytool -certreq -alias mykey -file req.csr \
#           -keystore NONE -storetype PKCS11 \
#           -providerClass sun.security.pkcs11.SunPKCS11 \
#           -providerArg /path/to/quac100_sunpkcs11.cfg
#
# Import certificate:
#   keytool -importcert -alias mykey -file cert.pem \
#           -keystore NONE -storetype PKCS11 \
#           -providerClass sun.security.pkcs11.SunPKCS11 \
#           -providerArg /path/to/quac100_sunpkcs11.cfg